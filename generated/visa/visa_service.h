
//---------------------------------------------------------------------
// This file is automatically generated. All manual edits will be lost.
//---------------------------------------------------------------------
// Service header for the VISA Metadata
//---------------------------------------------------------------------
#ifndef VISA_GRPC_SERVICE_H
#define VISA_GRPC_SERVICE_H

#include <visa.grpc.pb.h>
#include <condition_variable>
#include <grpcpp/grpcpp.h>
#include <grpcpp/health_check_service_interface.h>
#include <grpcpp/ext/proto_server_reflection_plugin.h>
#include <map>
#include <server/converters.h>
#include <server/feature_toggles.h>
#include <server/session_resource_repository.h>
#include <server/shared_library.h>
#include <server/exceptions.h>

#include "visa_library_interface.h"

namespace visa_grpc {

struct VisaFeatureToggles
{
  using CodeReadiness = nidevice_grpc::FeatureToggles::CodeReadiness;
  VisaFeatureToggles(const nidevice_grpc::FeatureToggles& feature_toggles = {});

  bool is_enabled;
};

class VisaService final : public Visa::Service {
public:
  using LibrarySharedPtr = std::shared_ptr<VisaLibraryInterface>;
  using ResourceRepositorySharedPtr = std::shared_ptr<nidevice_grpc::SessionResourceRepository<ViSession>>;
  using ViObjectResourceRepositorySharedPtr = std::shared_ptr<nidevice_grpc::SessionResourceRepository<ViObject>>;

  VisaService(
    LibrarySharedPtr library,
    ResourceRepositorySharedPtr resource_repository,
    ViObjectResourceRepositorySharedPtr vi_object_resource_repository,
    const VisaFeatureToggles& feature_toggles = {});
  virtual ~VisaService();

  ::grpc::Status AssertIntrSignal(::grpc::ServerContext* context, const AssertIntrSignalRequest* request, AssertIntrSignalResponse* response) override;
  ::grpc::Status AssertTrigger(::grpc::ServerContext* context, const AssertTriggerRequest* request, AssertTriggerResponse* response) override;
  ::grpc::Status AssertUtilSignal(::grpc::ServerContext* context, const AssertUtilSignalRequest* request, AssertUtilSignalResponse* response) override;
  ::grpc::Status Clear(::grpc::ServerContext* context, const ClearRequest* request, ClearResponse* response) override;
  ::grpc::Status Close(::grpc::ServerContext* context, const CloseRequest* request, CloseResponse* response) override;
  ::grpc::Status DisableEvent(::grpc::ServerContext* context, const DisableEventRequest* request, DisableEventResponse* response) override;
  ::grpc::Status DiscardEvents(::grpc::ServerContext* context, const DiscardEventsRequest* request, DiscardEventsResponse* response) override;
  ::grpc::Status EnableEvent(::grpc::ServerContext* context, const EnableEventRequest* request, EnableEventResponse* response) override;
  ::grpc::Status FindRsrc(::grpc::ServerContext* context, const FindRsrcRequest* request, FindRsrcResponse* response) override;
  ::grpc::Status Flush(::grpc::ServerContext* context, const FlushRequest* request, FlushResponse* response) override;
  ::grpc::Status GetAttribute(::grpc::ServerContext* context, const GetAttributeRequest* request, GetAttributeResponse* response) override;
  ::grpc::Status GpibCommand(::grpc::ServerContext* context, const GpibCommandRequest* request, GpibCommandResponse* response) override;
  ::grpc::Status GpibControlATN(::grpc::ServerContext* context, const GpibControlATNRequest* request, GpibControlATNResponse* response) override;
  ::grpc::Status GpibControlREN(::grpc::ServerContext* context, const GpibControlRENRequest* request, GpibControlRENResponse* response) override;
  ::grpc::Status GpibPassControl(::grpc::ServerContext* context, const GpibPassControlRequest* request, GpibPassControlResponse* response) override;
  ::grpc::Status GpibSendIFC(::grpc::ServerContext* context, const GpibSendIFCRequest* request, GpibSendIFCResponse* response) override;
  ::grpc::Status In16(::grpc::ServerContext* context, const In16Request* request, In16Response* response) override;
  ::grpc::Status In32(::grpc::ServerContext* context, const In32Request* request, In32Response* response) override;
  ::grpc::Status In64(::grpc::ServerContext* context, const In64Request* request, In64Response* response) override;
  ::grpc::Status In8(::grpc::ServerContext* context, const In8Request* request, In8Response* response) override;
  ::grpc::Status Lock(::grpc::ServerContext* context, const LockRequest* request, LockResponse* response) override;
  ::grpc::Status MapAddress(::grpc::ServerContext* context, const MapAddressRequest* request, MapAddressResponse* response) override;
  ::grpc::Status MapTrigger(::grpc::ServerContext* context, const MapTriggerRequest* request, MapTriggerResponse* response) override;
  ::grpc::Status MemAlloc(::grpc::ServerContext* context, const MemAllocRequest* request, MemAllocResponse* response) override;
  ::grpc::Status MemAllocEx(::grpc::ServerContext* context, const MemAllocExRequest* request, MemAllocExResponse* response) override;
  ::grpc::Status MemFree(::grpc::ServerContext* context, const MemFreeRequest* request, MemFreeResponse* response) override;
  ::grpc::Status MoveIn16(::grpc::ServerContext* context, const MoveIn16Request* request, MoveIn16Response* response) override;
  ::grpc::Status MoveIn32(::grpc::ServerContext* context, const MoveIn32Request* request, MoveIn32Response* response) override;
  ::grpc::Status MoveIn64(::grpc::ServerContext* context, const MoveIn64Request* request, MoveIn64Response* response) override;
  ::grpc::Status MoveIn8(::grpc::ServerContext* context, const MoveIn8Request* request, MoveIn8Response* response) override;
  ::grpc::Status MoveOut16(::grpc::ServerContext* context, const MoveOut16Request* request, MoveOut16Response* response) override;
  ::grpc::Status MoveOut32(::grpc::ServerContext* context, const MoveOut32Request* request, MoveOut32Response* response) override;
  ::grpc::Status MoveOut64(::grpc::ServerContext* context, const MoveOut64Request* request, MoveOut64Response* response) override;
  ::grpc::Status MoveOut8(::grpc::ServerContext* context, const MoveOut8Request* request, MoveOut8Response* response) override;
  ::grpc::Status Open(::grpc::ServerContext* context, const OpenRequest* request, OpenResponse* response) override;
  ::grpc::Status Out16(::grpc::ServerContext* context, const Out16Request* request, Out16Response* response) override;
  ::grpc::Status Out32(::grpc::ServerContext* context, const Out32Request* request, Out32Response* response) override;
  ::grpc::Status Out64(::grpc::ServerContext* context, const Out64Request* request, Out64Response* response) override;
  ::grpc::Status Out8(::grpc::ServerContext* context, const Out8Request* request, Out8Response* response) override;
  ::grpc::Status ParseRsrc(::grpc::ServerContext* context, const ParseRsrcRequest* request, ParseRsrcResponse* response) override;
  ::grpc::Status Peek16(::grpc::ServerContext* context, const Peek16Request* request, Peek16Response* response) override;
  ::grpc::Status Peek32(::grpc::ServerContext* context, const Peek32Request* request, Peek32Response* response) override;
  ::grpc::Status Peek64(::grpc::ServerContext* context, const Peek64Request* request, Peek64Response* response) override;
  ::grpc::Status Peek8(::grpc::ServerContext* context, const Peek8Request* request, Peek8Response* response) override;
  ::grpc::Status Poke16(::grpc::ServerContext* context, const Poke16Request* request, Poke16Response* response) override;
  ::grpc::Status Poke32(::grpc::ServerContext* context, const Poke32Request* request, Poke32Response* response) override;
  ::grpc::Status Poke64(::grpc::ServerContext* context, const Poke64Request* request, Poke64Response* response) override;
  ::grpc::Status Poke8(::grpc::ServerContext* context, const Poke8Request* request, Poke8Response* response) override;
  ::grpc::Status PxiReserveTriggers(::grpc::ServerContext* context, const PxiReserveTriggersRequest* request, PxiReserveTriggersResponse* response) override;
  ::grpc::Status Read(::grpc::ServerContext* context, const ReadRequest* request, ReadResponse* response) override;
  ::grpc::Status ReadAsync(::grpc::ServerContext* context, const ReadAsyncRequest* request, ReadAsyncResponse* response) override;
  ::grpc::Status ReadSTB(::grpc::ServerContext* context, const ReadSTBRequest* request, ReadSTBResponse* response) override;
  ::grpc::Status SetAttribute(::grpc::ServerContext* context, const SetAttributeRequest* request, SetAttributeResponse* response) override;
  ::grpc::Status SetBuf(::grpc::ServerContext* context, const SetBufRequest* request, SetBufResponse* response) override;
  ::grpc::Status StatusDesc(::grpc::ServerContext* context, const StatusDescRequest* request, StatusDescResponse* response) override;
  ::grpc::Status Terminate(::grpc::ServerContext* context, const TerminateRequest* request, TerminateResponse* response) override;
  ::grpc::Status Unlock(::grpc::ServerContext* context, const UnlockRequest* request, UnlockResponse* response) override;
  ::grpc::Status UnmapAddress(::grpc::ServerContext* context, const UnmapAddressRequest* request, UnmapAddressResponse* response) override;
  ::grpc::Status UnmapTrigger(::grpc::ServerContext* context, const UnmapTriggerRequest* request, UnmapTriggerResponse* response) override;
  ::grpc::Status UsbControlIn(::grpc::ServerContext* context, const UsbControlInRequest* request, UsbControlInResponse* response) override;
  ::grpc::Status UsbControlOut(::grpc::ServerContext* context, const UsbControlOutRequest* request, UsbControlOutResponse* response) override;
  ::grpc::Status VxiCommandQuery(::grpc::ServerContext* context, const VxiCommandQueryRequest* request, VxiCommandQueryResponse* response) override;
  ::grpc::Status WaitOnEvent(::grpc::ServerContext* context, const WaitOnEventRequest* request, WaitOnEventResponse* response) override;
  ::grpc::Status Write(::grpc::ServerContext* context, const WriteRequest* request, WriteResponse* response) override;
  ::grpc::Status WriteAsync(::grpc::ServerContext* context, const WriteAsyncRequest* request, WriteAsyncResponse* response) override;
private:
  LibrarySharedPtr library_;
  ResourceRepositorySharedPtr session_repository_;
  ViObjectResourceRepositorySharedPtr vi_object_resource_repository_;
  ::grpc::Status ConvertApiErrorStatusForViSession(::grpc::ServerContextBase* context, int32_t status, ViSession vi);
  ::grpc::Status ConvertApiErrorStatusForViObject(::grpc::ServerContextBase* context, int32_t status, ViObject vi);

  VisaFeatureToggles feature_toggles_;
};

} // namespace visa_grpc

#endif  // VISA_GRPC_SERVICE_H
